<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title></title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Alata&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Alatsi&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Allerta&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Andika+New+Basic&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Atkinson+Hyperlegible&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Barlow&amp;display=swap">
	<link href="https://fonts.googleapis.com/css?family=Raleway:400,300,600,800,900" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="assets/fonts/fontawesome-all.min.css">
    <link rel="stylesheet" href="assets/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="assets/css/styles.css">
	<script src="assets/js/jquery.min.js"></script>
	<script type="text/javascript">
		$(document).ready( function () {
			
			var course_id = "ENG1";
			
			var quiz_id = localStorage.getItem('quiz_ID');
			<!-- var quiz_id = "QZENG1"; -->

            $('#loadingModal').modal('toggle');
			
			$("#quiz_id_direct").html("&nbsp;&nbsp;>&nbsp;&nbsp;"+quiz_id);
			
			var total_question_no = 0;
			
			question_types = [];
			qlist_id = [];
			mc_questions_id = [];
			mc_answers_id = [[],[]];
			
			async function get_questions() {
				
				const endpoint = '/data-api/rest/QuestionList';
				const response = await fetch(endpoint);
				const data = await response.json();
				
				<!-- data = JSON.parse('{"value":[{"id":24,"course_id":"ENG1","quiz_id":"QZENG1","q_id":"2","q_type":"mc"},{"id":25,"course_id":"ENG1","quiz_id":"QZENG1","q_id":"1","q_type":"mc"},{"id":26,"course_id":"ENG1","quiz_id":"QZENG1","q_id":"3","q_type":"mc"},{"id":27,"course_id":"ENG1","quiz_id":"QZENG1","q_id":"4","q_type":"mc"}]}'); -->
				
				for (var i = 0; i < data.value.length; i++) { 
                    if (data.value[i].quiz_id == quiz_id) {
						question_types[data.value[i].q_id-1] = data.value[i].q_type;
						qlist_id[data.value[i].q_id-1] = data.value[i].id;
					}
                }
				
				total_question_no = question_types.length;
				
				for (var i = 0; i < question_types.length; i++) {
				
					mc_answers_id[i] = [];
					
					if (question_types[i] == "mc") {
						$("#question_list").append('<div class="row" id="ques_list_item_'+(i+1)+'">'+
								'<input class="quest_type" type="hidden" value="multi_choice">'+
								'<div class="col ms-3 me-3 mt-2">'+
								'<hr style="color: #bbbbbb;">'+
								'<div class="row mt-4">'+
									'<div class="col-auto">'+
										'<div class="card shadow-none p-3" style="height: auto; border: 1px solid #e5e5e5; background-color: #eeeeee; border-radius: 0px;">'+
											'<div class="row mb-2">'+
												'<span style="font-size: 1.1rem; color:#f69c5d; font-weight: 500; font-family: '+"'Trebuchet MS'"+', Arial, Verdana, Helvetica, sans-serif;">Question <span style="font-weight: 700; color:#f9811c; font-family: '+"'Trebuchet MS'"+', Arial, Verdana, Helvetica, sans-serif;">'+(i+1)+'</span><span>'+
											'</div>'+
											'<div class="row">'+
												'<span style="font-size: 0.75rem; color:rgb(0,0,0); font-weight: 400; font-family: '+"'Trebuchet MS'"+', Arial, Verdana, Helvetica, sans-serif;">Multiple Choice<span>'+
											'</div>'+
											'<div class="row">'+
												'<span style="font-size: 0.75rem; color:rgb(0,0,0); font-weight: 400; font-family: '+"'Trebuchet MS'"+', Arial, Verdana, Helvetica, sans-serif;">Marked out of 1.00.<span>'+
											'</div>'+
										'</div>'+
									'</div>'+
									'<div class="col">'+
										'<div class="card shadow-none p-3" style="height: auto; border: 1px solid #ccecf5; background-color: #d9edf7; border-radius: 0px;">'+
											'<label for="mc_question_'+(i+1)+'" class="form-label" style="font-size: 0.95rem; font-weight: 400; font-family: '+"'Trebuchet MS'"+', Arial, Verdana, Helvetica, sans-serif;">Please write your question in the box below.</label>'+
											'<textarea class="form-control" id="mc_question_'+(i+1)+'" style="font-size: 0.85rem; font-weight: 400; font-family: '+"'Trebuchet MS'"+', Arial, Verdana, Helvetica, sans-serif; border-radius: 0px;" rows="5"></textarea>'+
										'</div>'+
										'<div class="card shadow-none p-3 mt-3" style="height: auto; border: 1px solid #edf5e6; background-color: #dff0d8; border-radius: 0px;">'+
											'<div class="row">'+
												'<div class="col-auto">'+
													'<label for="mc_ans_1_'+(i+1)+'" class="form-label" style="font-size: 0.95rem; font-weight: 400; font-family: '+"'Trebuchet MS'"+', Arial, Verdana, Helvetica, sans-serif;">1st Answer Choice</label>'+
												'</div>'+
												'<div class="col">'+
													'<div class="form-check">'+
													  '<input class="form-check-input" type="radio" name="mc_correct_radio_'+(i+1)+'" id="mc_correct_ans_1_'+(i+1)+'">'+
													  '<label class="form-check-label" for="mc_correct_ans_1_'+(i+1)+'" style="font-size: 0.8rem; color: green; font-weight: 200; font-family: '+"'Trebuchet MS'"+', Arial, Verdana, Helvetica, sans-serif;">'+
														'Correct Answer'+
													  '</label>'+
													'</div>'+
												'</div>'+
											'</div>'+
											'<textarea class="form-control mb-3" id="mc_ans_1_'+(i+1)+'" style="font-size: 0.85rem; font-weight: 400; font-family: '+"'Trebuchet MS'"+', Arial, Verdana, Helvetica, sans-serif; border-radius: 0px;" rows="1"></textarea>'+
											'<div class="row">'+
												'<div class="col-auto">'+
													'<label for="mc_ans_2_'+(i+1)+'" class="form-label" style="font-size: 0.95rem; font-weight: 400; font-family: '+"'Trebuchet MS'"+', Arial, Verdana, Helvetica, sans-serif;">2nd Answer Choice</label>'+
												'</div>'+
												'<div class="col">'+
													'<div class="form-check">'+
													  '<input class="form-check-input" type="radio" name="mc_correct_radio_'+(i+1)+'" id="mc_correct_ans_2_'+(i+1)+'">'+
													  '<label class="form-check-label" for="mc_correct_ans_2_'+(i+1)+'" style="font-size: 0.8rem; color: green; font-weight: 200; font-family: '+"'Trebuchet MS'"+', Arial, Verdana, Helvetica, sans-serif;" hidden>'+
														'Correct Answer'+
													  '</label>'+
													'</div>'+
												'</div>'+
											'</div>'+
											'<textarea class="form-control mb-3" id="mc_ans_2_'+(i+1)+'" style="font-size: 0.85rem; font-weight: 400; font-family: '+"'Trebuchet MS'"+', Arial, Verdana, Helvetica, sans-serif; border-radius: 0px;" rows="1"></textarea>'+
											'<div class="row">'+
												'<div class="col-auto">'+
													'<label for="mc_ans_3_'+(i+1)+'" class="form-label" style="font-size: 0.95rem; font-weight: 400; font-family: '+"'Trebuchet MS'"+', Arial, Verdana, Helvetica, sans-serif;">3rd Answer Choice</label>'+
												'</div>'+
												'<div class="col">'+
													'<div class="form-check">'+
													  '<input class="form-check-input" type="radio" name="mc_correct_radio_'+(i+1)+'" id="mc_correct_ans_3_'+(i+1)+'">'+
													  '<label class="form-check-label" for="mc_correct_ans_3_'+(i+1)+'" style="font-size: 0.8rem; color: green; font-weight: 200; font-family: '+"'Trebuchet MS'"+', Arial, Verdana, Helvetica, sans-serif;" hidden>'+
														'Correct Answer'+
													  '</label>'+
													'</div>'+
												'</div>'+
											'</div>'+
											'<textarea class="form-control mb-3" id="mc_ans_3_'+(i+1)+'" style="font-size: 0.85rem; font-weight: 400; font-family: '+"'Trebuchet MS'"+', Arial, Verdana, Helvetica, sans-serif; border-radius: 0px;" rows="1"></textarea>'+
											'<div class="row">'+
												'<div class="col-auto">'+
													'<label for="mc_ans_4_'+(i+1)+'" class="form-label" style="font-size: 0.95rem; font-weight: 400; font-family: '+"'Trebuchet MS'"+', Arial, Verdana, Helvetica, sans-serif;">4th Answer Choice</label>'+
												'</div>'+
												'<div class="col">'+
													'<div class="form-check">'+
													  '<input class="form-check-input" type="radio" name="mc_correct_radio_'+(i+1)+'" id="mc_correct_ans_4_'+(i+1)+'">'+
													  '<label class="form-check-label" for="mc_correct_ans_4_'+(i+1)+'" style="font-size: 0.8rem; color: green; font-weight: 200; font-family: '+"'Trebuchet MS'"+', Arial, Verdana, Helvetica, sans-serif;" hidden>'+
														'Correct Answer'+
													  '</label>'+
													'</div>'+
												'</div>'+
											'</div>'+
											'<textarea class="form-control" id="mc_ans_4_'+(i+1)+'" style="font-size: 0.85rem; font-weight: 400; font-family: '+"'Trebuchet MS'"+', Arial, Verdana, Helvetica, sans-serif; border-radius: 0px;" rows="1"></textarea>'+
										'</div>'+
									'</div>'+
								'</div>'+
							'</div>'+
						'</div>');
					}
				}
				
				const endpoint2 = '/data-api/rest/mc_Questions';
				const response2 = await fetch(endpoint2);
				const data2 = await response2.json();
				
				<!-- data2 = JSON.parse('{"value":[{"id":19,"course_id":"ENG1","quiz_id":"QZENG1","q_id":"1","question":"This is Question 1?","correct_ans_id":"2"},{"id":20,"course_id":"ENG1","quiz_id":"QZENG1","q_id":"3","question":"This is Question 3?","correct_ans_id":"4"},{"id":21,"course_id":"ENG1","quiz_id":"QZENG1","q_id":"2","question":"This is Question 2?","correct_ans_id":"3"},{"id":22,"course_id":"ENG1","quiz_id":"QZENG1","q_id":"4","question":"This is Question 4?","correct_ans_id":"1"}]}'); -->
				
				for (var j = 0; j < data2.value.length; j++) {
					if(data2.value[j].quiz_id == quiz_id){
						mc_questions_id[data2.value[j].q_id-1] = data2.value[j].id;
						
						$(document).find("#mc_question_"+data2.value[j].q_id).val(data2.value[j].question);
						$(document).find("#mc_correct_ans_"+data2.value[j].correct_ans_id+"_"+data2.value[j].q_id).prop('checked', true);
					}
				}
				
				const endpoint3 = '/data-api/rest/mc_Answers';
				const response3 = await fetch(endpoint3);
				const data3 = await response3.json();
				
				<!-- data3 = JSON.parse('{"value":[{"id":73,"course_id":"ENG1","quiz_id":"QZENG1","q_id":"1","ans_id":"2","answer":"haha hoho answer 1 of 2 korek"},{"id":74,"course_id":"ENG1","quiz_id":"QZENG1","q_id":"1","ans_id":"4","answer":"haha hoho answer 1 of 4"},{"id":75,"course_id":"ENG1","quiz_id":"QZENG1","q_id":"1","ans_id":"3","answer":"haha hoho answer 1 of 3"},{"id":76,"course_id":"ENG1","quiz_id":"QZENG1","q_id":"1","ans_id":"1","answer":"haha hoho answer 1 of 1"},{"id":77,"course_id":"ENG1","quiz_id":"QZENG1","q_id":"3","ans_id":"2","answer":"haha hoho answer 3 of 2"},{"id":78,"course_id":"ENG1","quiz_id":"QZENG1","q_id":"2","ans_id":"1","answer":"haha hoho answer 2 of 1"},{"id":79,"course_id":"ENG1","quiz_id":"QZENG1","q_id":"3","ans_id":"3","answer":"haha hoho answer 3 of 3"},{"id":80,"course_id":"ENG1","quiz_id":"QZENG1","q_id":"4","ans_id":"2","answer":"haha hoho answer 4 of 2"},{"id":81,"course_id":"ENG1","quiz_id":"QZENG1","q_id":"2","ans_id":"3","answer":"haha hoho answer 2 of 3 korek"},{"id":82,"course_id":"ENG1","quiz_id":"QZENG1","q_id":"4","ans_id":"3","answer":"haha hoho answer 4 of 3"},{"id":83,"course_id":"ENG1","quiz_id":"QZENG1","q_id":"3","ans_id":"1","answer":"haha hoho answer 3 of 1"},{"id":84,"course_id":"ENG1","quiz_id":"QZENG1","q_id":"4","ans_id":"4","answer":"haha hoho answer 4 of 4"},{"id":85,"course_id":"ENG1","quiz_id":"QZENG1","q_id":"2","ans_id":"4","answer":"haha hoho answer 2 of 4"},{"id":86,"course_id":"ENG1","quiz_id":"QZENG1","q_id":"3","ans_id":"4","answer":"haha hoho answer 3 of 4 korek"},{"id":87,"course_id":"ENG1","quiz_id":"QZENG1","q_id":"4","ans_id":"1","answer":"haha hoho answer 4 of 1 korek"},{"id":88,"course_id":"ENG1","quiz_id":"QZENG1","q_id":"2","ans_id":"2","answer":"haha hoho answer 2 of 2"}]}'); -->
				
				for (var j = 0; j < data3.value.length; j++) {
					if(data3.value[j].quiz_id == quiz_id){
						mc_answers_id[data3.value[j].q_id-1][data3.value[j].ans_id-1] = data3.value[j].id;
						
						$(document).find("#mc_ans_"+data3.value[j].ans_id+"_"+data3.value[j].q_id).val(data3.value[j].answer);
					}
				}
				
				$(document).find("input[type=radio]").each(function(){
					if ($(this).is(':checked')){
						$(this).next('label').attr("hidden",false);
					} else {
						$(this).next('label').attr("hidden",true);
					}
				});
                
                $("#delete_button").prop('disabled', false);

                setTimeout(()=> {
					$('#loadingModal').modal('toggle');
				},500);
				
			}
			
			get_questions();


			$(document).on('change', 'input[type=radio]', function(e) {
				$(document).find("input[type=radio]").each(function(){
					if ($(this).is(':checked')){
						$(this).next('label').attr("hidden",false);
					} else {
						$(this).next('label').attr("hidden",true);
					}
				});
			});
			
			$(document).on('change keyup paste', 'textarea', function(e) {
				$("#submit_button").prop('disabled', false);
			});
			
			$('#submit_button').on('click', function(e){
				for (let i = 1; i <= total_question_no; i++) {
					data4 = '{"course_id": "'+course_id+'", "quiz_id": "'+quiz_id+'", "q_id": '+i+', "q_type": "';
					quest_type = $(document).find("#ques_list_item_"+i).children(".quest_type").val();
					if ( quest_type == "multi_choice") {
						data4 += 'mc"}';
					}
					
					<!-- alert(qlist_id[i-1]+data4); -->
					update_QuestionList(qlist_id[i-1],JSON.parse(data4));
					
					data5 = '{"course_id": "'+course_id+'", "quiz_id": "'+quiz_id+'", "q_id": '+i+', "question": "';
					if ( quest_type == "multi_choice") {
						ques = $(document).find("#mc_question_"+i).val();
						data5 += ques;
						data5 += '", "correct_ans_id": ';
						
						correct_ans_id = "";
						
						$("#ques_list_item_"+i).find("input[type=radio]").each(function(){
							if ($(this).is(':checked')){
								correct_ans_id = $(this).attr('id');
							} 
						});
						
						data5 += correct_ans_id.charAt(15);
						data5 += '}';
						
						<!-- alert(mc_questions_id[i-1]+data5); -->
						update_mc_Questions(mc_questions_id[i-1],JSON.parse(data5));
						
						for (let j = 1; j <= 4; j++) {
							data6 = '{"course_id": "'+course_id+'", "quiz_id": "'+quiz_id+'", "q_id": '+i+', "ans_id": '+j+', "answer": "';
							ans = $(document).find("#mc_ans_"+j+"_"+i).val();
							data6 += ans;
							data6 += '"}';
							
							<!-- alert(mc_answers_id[i-1][j-1]+data6); -->
							update_mc_Answers(mc_answers_id[i-1][j-1],JSON.parse(data6));
						}
					}
				}
			});
			
			$('#delete_button').on('click', function(e){
				for (var i = 0; i < question_types.length; i++) {

					<!-- alert(qlist_id[i]); -->
					delete_QuestionList(qlist_id[i]);

					if (question_types[i] == "mc") {
						
						<!-- alert(mc_questions_id[i]); -->
						delete_mc_Questions(mc_questions_id[i]);
						
						for (var j = 0; j < mc_answers_id[i].length; j++) {
							
							<!-- alert(mc_answers_id[i][j]); -->
							delete_mc_Answers(mc_answers_id[i][j]);
						}
					}
				}
			});

			async function update_QuestionList(id,data) {
				const endpoint = '/data-api/rest/QuestionList/id';
				const response = await fetch(`${endpoint}/${id}`, {
					method: "PUT",
					headers: { "Content-Type": "application/json" },
					body: JSON.stringify(data)
				});
				const result = await response.json();
				alert(JSON.stringify(result.value));			
			}
			
			async function update_mc_Questions(id,data) {
				const endpoint = '/data-api/rest/mc_Questions/id';
				const response = await fetch(`${endpoint}/${id}`, {
					method: "PUT",
					headers: { "Content-Type": "application/json" },
					body: JSON.stringify(data)
				});
				const result = await response.json();
				alert(JSON.stringify(result.value));
			}
			
			async function update_mc_Answers(id,data) {
				const endpoint = '/data-api/rest/mc_Answers/id';
				const response = await fetch(`${endpoint}/${id}`, {
					method: "PUT",
					headers: { "Content-Type": "application/json" },
					body: JSON.stringify(data)
				});
				const result = await response.json();
				alert(JSON.stringify(result.value));
			}
			
			async function delete_QuestionList(id) {
				const endpoint = '/data-api/rest/QuestionList/id';
				const response = await fetch(`${endpoint}/${id}`, {
					method: "DELETE"
				});
				alert(response);	
			}
			
			async function delete_mc_Questions(id) {
				const endpoint = '/data-api/rest/mc_Questions/id';
				const response = await fetch(`${endpoint}/${id}`, {
					method: "DELETE"
				});
				alert(response);
			}
			
			async function delete_mc_Answers(id) {
				const endpoint = '/data-api/rest/mc_Answers/id';
				const response = await fetch(`${endpoint}/${id}`, {
					method: "DELETE"
				});
				alert(response);
			}
			
		} );
	</script>
</head>

<body style="background: white; background-size: cover; ">
	<div class="modal fade" id="loadingModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	  <div class="modal-dialog modal-dialog-centered">
		<div class="modal-content" style="margin: auto; width: auto; height: auto; border-radius: 0; border:0;">
		  <div class="modal-body">
			<img src="assets/images/loading.gif" style="height: 4rem;">
		  </div>
		</div>
	  </div>
	</div>
	<div class="row" style="border-bottom: 1px solid #cfcfcf; background: white; padding-top: 2px; padding-bottom: 3px;">
		<div class="col" style="margin-top: auto; margin-bottom: auto; margin-left: 15px;">
			<img src="assets/images/nottingham-university-logo.jpeg" alt="University of Nottingham" style="height: 3.5rem;">
		</div>
		<div class="col-auto" style="margin-top: auto; margin-bottom: auto;">
			<i class="far fa-bell" style="color:#a5a5a5; font-size: 1rem;"></i>
		</div>
		<div class="col-auto" style="margin-top: auto; margin-bottom: auto;">
			<i class="far fa-comment" style="color:#a5a5a5; font-size: 1rem;"></i>
		</div>
		<div class="col-auto" style="text-align: right; margin-top: auto; margin-bottom: auto;">
			<i class="fas fa-user-circle" style="color:#792d85; font-size: 2.2rem;"></i>
		</div>
		<div class="col-auto" style="margin-top: auto; margin-bottom: auto; margin-right: 25px; margin-left: -15px">
			<i class="fas fa-chevron-down" style="color:black; font-size: 0.6rem;"></i>
		</div>
	</div>
	<div class="row ms-4 me-4 mt-3 mb-2">
		<div class="card" style="height: auto; border: 1px solid #cfcfcf; border-radius: 0px;">
			<div class="row ms-2 mt-3 me-2 mb-0">
				<div class="col-auto p-0">
					<span class="fa-stack fa-2x">
					  <i class="fas fa-square-full fa-stack-1x" style="color:rgba(147,213,0,1); font-size: 3.3rem;"></i>
					  <i class="far fa-edit fa-stack-1x" style="color:rgba(255,255,255,1); font-size: 1.4rem;"></i>
					</span>
				</div>
				<div class="col">
					<div class=""><span style="font-size: 2.3rem; color:rgb(0,0,0); font-weight: 700; font-family: 'Trebuchet MS', Arial, Verdana, Helvetica, sans-serif;">Quiz Editor<span></div>
				</div>
			</div>
			<div class="row ms-2 mt-2 me-2 mb-4">
				<div class="col">
					<div class=""><span style="font-size: 0.92rem; color:#1568ac; font-weight: 500; font-family: 'Trebuchet MS', Arial, Verdana, Helvetica, sans-serif; cursor: pointer;" onclick="location.href = 'dashboard.html';"><u>Dashboard</u></span><span style="font-size: 0.92rem; color:#5b595f; font-weight: 500;">&nbsp;&nbsp;>&nbsp;&nbsp;</span><span style="font-size: 0.92rem; color:#1568ac; font-weight: 500; font-family: 'Trebuchet MS', Arial, Verdana, Helvetica, sans-serif; cursor: pointer;" onclick="location.href = 'editor.html';"><u>Quiz Editor</u></span><span style="font-size: 0.92rem; color:#5b595f; font-weight: 500;" id="quiz_id_direct">&nbsp;&nbsp;>&nbsp;&nbsp;</span></div>
				</div>
			</div>
		</div>
	</div>
	<div class="row ms-4 me-4 mt-3 mb-2">
		<div class="card pb-4" style="height: auto; border: 1px solid #cfcfcf; border-radius: 0px;">
			<div id="question_list">
			</div>
			<hr style="color: #bbbbbb;">
			<div class="row ms-2 mt-1 me-2">
				<div class="col">
				  <button type="button" disabled class="btn ps-4 pe-4 pt-2 pb-2" type="button" style="background-color:#b32b76; color: white; font-weight: lighter; font-family: 'Trebuchet MS', sans-serif; font-size: 0.92rem; border-radius: 0px;" id="submit_button">Update Quiz</button>
				</div>
				<div class="col-auto">
				  <button type="button" disabled class="btn ps-4 pe-4 pt-2 pb-2" type="button" style="background-color: red; color: white; font-weight: lighter; font-family: 'Trebuchet MS', sans-serif; font-size: 0.92rem; border-radius: 0px;" id="delete_button">Delete Quiz</button>
				</div>
			</div>
		</div>	
	</div>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
</body>

</html>